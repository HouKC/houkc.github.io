---
layout:     post
title:      DVWA靶机学习——SQL Injection(盲注)
subtitle:   这个系列是学习DVWA靶机的。今天学习SQL Injection的Low、Medium、High、Impossible级别。
date:       2020-11-17
author:     HouKC
header-img: img/home-bg-geek.jpg
catalog:    true
tags:
    - CTF
    - web
    - writeup
    - 网络安全
    - dvwa
    - 靶机
---


## 0x00 SQL Injection(盲注)
盲注是指，在SQL注入过程中，服务器没有给客户端回显，导致我们无法直接判断注入的结果。这时就得利用基于时间的盲注和基于布尔的盲注来判断结果。

基于时间的盲注是利用延时函数来使注入结果正确时的响应时间与结果错误时的响应时间有较大的时差，这样一来就可以判断注入是否成功；而基于布尔的盲注是根据注入成功返回的页面为正常、注入失败时返回的页面为错误页面来判断的。

注意可能在设置好级别后点进SQL Injection（盲注）时会遇到如下报错：
```
Parse error: syntax error, unexpected '[' in D:\php\phpStudy_64\phpstudy_pro\WWW\dvwa\vulnerabilities\sqli_blind\index.php on line 65
```
是源码有误导致，修改dvwa/vulnerabilities/sqli_blind/index.php文件第65行，将最后的“[0]”去掉即可，如下：
```php
$num = mysqli_fetch_row( $result )[0];
修改为
$num = mysqli_fetch_row( $result );
```

## 0x01 Low
#### 源码分析
```php
<?php

if( isset( $_GET[ 'Submit' ] ) ) {
    // Get input
    $id = $_GET[ 'id' ];

    // Check database
    $getid  = "SELECT first_name, last_name FROM users WHERE user_id = '$id';";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $getid ); // Removed 'or die' to suppress mysql errors

    // Get results
    $num = @mysqli_num_rows( $result ); // The '@' character suppresses errors
    if( $num > 0 ) {
        // Feedback for end user
        echo '<pre>User ID exists in the database.</pre>';
    }
    else {
        // User wasn't found, so the page wasn't!
        header( $_SERVER[ 'SERVER_PROTOCOL' ] . ' 404 Not Found' );

        // Feedback for end user
        echo '<pre>User ID is MISSING from the database.</pre>';
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);
}

?>
```
可以看到参数id没有任何过滤，就直接将用户输入插入到sql语句中，直接万能秘钥“1' or 1=1 #”即可开始注入测试。


#### 解题思路
